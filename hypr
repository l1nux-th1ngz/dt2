#!/bin/bash

# Install RustUp
sudo pacman -S --noconfirm rustup

# Set DEFAULT, PROFILE, and RUN for RustUp
rustup default nightly
rustup completions bash | sudo tee /etc/bash_completion.d/rustup
source $HOME/.cargo/env

# Install Software and Desktop
sudo pacman -S --noconfirm gdb ninja gcc cmake meson libxcb xcb-proto xcb-util xcb-util-keysyms libxfixes libx11 libxcomposite xorg-xinput libxrender \
pixman wayland-protocols cairo pango seatd libxkbcommon xcb-util-wm xorg-xwayland libinput libliftoff libdisplay-info cpio tomlplusplus \
hyprland waybar kitty firefox nodejs go kvantum wofi gvfs thunar geany geany-plugins gtk2 gtk3 gtk4 gtk-layer-shell grim layer-shell-qt wlsunset \
pixman automake autoconf autoconf-archive gjs marker nwg-look tilix libindicator-gtk2 libfm-gtk2 libfm-gtk3 xdg-utils libxdg-basedir ffmpeg \
xdg-desktop-portal xdg-desktop-portal-gtk xdg-desktop-portal-wlr libindicator-gtk3 font-manager xdg-desktop-portal-hyprland terminator \
archinstall arch-install-scripts archiso archivetools base-devel multilib-devel alsa-firmware linux-firmware sof-firmware udisks2 udiskie \
pantheon-code tumbler gdk-pixbuf2 vala libhandy zeitgeist sqlite granite granite7 gum bzip3 fuse-zip p7zip unzip zip zlib libzip gtk-chtheme \
imagemagick mpv viewnoir zathura gtk-engines vivid gtk-theme-elementary gtk-engine-murrine neofetch lsd thefuck adwaita-icon-theme arc-icon-theme \
ffmpegthumbnailer polkit-kde-agent sddm

# Update User Directories
xdg-user-dirs-update

# Copy to .config
cp -R waybar ~/.config
cp -R wofi ~/.config
cp -R kitty ~/.config
cp -R nwg-look ~/.config
cp -R tilix ~/.config
cp -R terminator ~/.config
cp -R mpv ~/.config
cp -R font-manager ~/.config
cp -R zathura ~/.config
cp -R neofetch ~/.config

# Fix config for hyprland
sed -i '/monitor/d' ~/.config/hypr/hypr.conf
echo "monitor = eDP-1,1920x1080@60, 0x0, 1" >> ~/.config/hypr/hypr.conf
sed -i '/autogenerated/d' ~/.config/hypr/hypr.conf

# Enable SDDM
read -n1 -rep 'Would you like to enable SDDM autologin? (N)' SDDM
if [[ $SDDM == "Y" || $SDDM == "y" ]]; then
    LOC="/etc/sddm.conf"
    echo -e "The following has been added to $LOC.\n"
    echo -e "[Autologin]\nUser = $(whoami)\nSession=hyprland" | sudo tee -a $LOC
    echo -e "\n"
    echo -e "Enabling SDDM service...\n"
    sudo systemctl enable sddm
    sleep 3
fi

# Install Plymouth
sudo pacman -S --noconfirm plymouth

# Add HOOKS to plymouth in mkinitcpio
sudo sed -i 's/^HOOKS.*/HOOKS=(base udev autodetect modconf block encrypt lvm2 filesystems fsck plymouth)/' /etc/mkinitcpio.conf

# Regenerate initramfs
sudo mkinitcpio -p linux

# Custom Grub Settings
sudo sed -i 's/^GRUB_DEFAULT.*/GRUB_DEFAULT=0/' /etc/default/grub
sudo sed -i 's/^GRUB_TIMEOUT.*/GRUB_TIMEOUT=0/' /etc/default/grub
sudo sed -i 's/^GRUB_CMDLINE_LINUX_DEFAULT.*/GRUB_CMDLINE_LINUX_DEFAULT="loglevel=3 quiet splash"/' /etc/default/grub
sudo grub-mkconfig -o /boot/grub/grub.cfg

# Set Plymouth theme
sudo plymouth-set-default-theme -R glow

# Disable and enable SDDM with Plymouth
sudo systemctl disable sddm
sudo systemctl enable sddm-plymouth

# Check display manager status
systemctl status display-manager
